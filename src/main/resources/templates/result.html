<!DOCTYPE html>
<html style="font-size: 16px;" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <meta name="keywords" content="ELECTION RESULTS">
  <meta name="description" content="Election Results">
  <meta name="page_type" content="np-template-header-footer-from-plugin">
  <title>Election Results || SOVS</title>
  <link rel="stylesheet" href="/css/nicepage.css" media="screen">
  <link rel="stylesheet" href="/css/Home.css" media="screen">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script class="u-script" type="text/javascript" src="/js/jquery.js" defer=""></script>
  <script class="u-script" type="text/javascript" src="/js/nicepage.js" defer=""></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta name="generator" content="Nicepage 4.10.5, nicepage.com">
  <link id="u-theme-google-font" rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
  <link id="u-page-google-font" rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i|Lemon:400|Andada+Pro:400,400i,500,500i,600,600i,700,700i,800,800i">

  <script src="/js/confetti.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Start confetti if this is the winner announcement
      if (document.querySelector('.winner-announcement')) {
        setTimeout(function() {
          confetti.start();
          // Stop confetti after 5 seconds
          setTimeout(function() { confetti.stop(); }, 5000);
        }, 1000);
      }
    });
  </script>
  <style>
    .results-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    .winner-announcement {
      text-align: center;
      margin: 2rem 0;
      padding: 2rem;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .winner-badge {
      display: inline-block;
      background: #ffd700;
      color: #8b6914;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: bold;
      margin-bottom: 1rem;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .candidate-card {
      display: flex;
      align-items: center;
      background: white;
      margin: 1rem 0;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .candidate-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .candidate-image {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 2rem;
      border: 3px solid #f0f0f0;
    }
    .candidate-info {
      flex: 1;
    }
    .candidate-name {
      font-size: 1.5rem;
      font-weight: bold;
      margin: 0 0 0.5rem 0;
      color: #333;
    }
    .candidate-party {
      font-size: 1.1rem;
      color: #666;
      margin-bottom: 0.5rem;
    }
    .vote-count {
      font-size: 1.2rem;
      font-weight: bold;
      color: #2c3e50;
    }
    .vote-percentage {
      display: inline-block;
      background: #e8f4fc;
      color: #2980b9;
      padding: 0.3rem 0.8rem;
      border-radius: 15px;
      font-size: 0.9rem;
      margin-left: 1rem;
    }
    .progress-container {
      height: 10px;
      background: #f0f0f0;
      border-radius: 5px;
      margin: 1rem 0;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #3498db, #2ecc71);
      width: 0;
      transition: width 1s ease-in-out;
    }
    .stats-card {
      background: white;
      border-radius: 10px;
      padding: 1.5rem;
      margin: 1rem 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .stat-item {
      text-align: center;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #2c3e50;
      margin: 0.5rem 0;
    }
    .stat-label {
      color: #7f8c8d;
      font-size: 0.9rem;
    }
    .error-message {
      background: #ffebee;
      color: #c62828;
      padding: 1rem;
      border-radius: 5px;
      text-align: center;
      margin: 2rem 0;
    }
    .party-logo {
      width: 60px;
      height: 60px;
      object-fit: contain;
      margin-right: 1rem;
    }
    .candidate-header {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .chart-container {
      margin: 2rem 0;
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
  </style>
</head>

<body class="u-body u-xl-mode">
  <div class="results-container">
    <!-- Error Message -->
    <div th:if="${error}" class="error-message">
      <i class="fas fa-exclamation-circle" style="margin-right: 0.5rem;"></i>
      <span th:text="${error}"></span>
    </div>

    <!-- Winner Announcement -->
    <div th:if="${winningParty}" class="winner-announcement">
      <div class="winner-badge">
        <i class="fas fa-trophy" style="margin-right: 0.5rem;"></i>
        ELECTION WINNER
      </div>
      <h1 class="u-custom-font u-hover-feature u-text u-text-palette-2-base u-title u-text-1">
        CONGRATULATIONS!
      </h1>
      
      <div style="display: flex; justify-content: center; align-items: center; margin: 2rem 0;">
        <img class="u-image u-image-round u-radius-31 u-image-1"
          th:src="${winningParty.partypic}" 
          style="width: 120px; height: 120px; object-fit: cover; border: 5px solid #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        
        <img class="u-image u-image-circle u-image-2" 
          th:src="${winningParty.candidateImagePath}"
          style="width: 200px; height: 200px; object-fit: cover; border: 5px solid #ffd700; margin: 0 2rem;">
        
        <img class="party-logo" th:src="${winningParty.partypic}">
      </div>
      
      <h2 class="candidate-name" style="font-size: 2rem; margin: 1rem 0 0.5rem 0;">
        <span th:text="${winningParty.firstname} + ' ' + ${winningParty.lastname}"></span>
      </h2>
      
      <p class="candidate-party" style="font-size: 1.3rem; margin-bottom: 1rem;">
        <i class="fas fa-landmark" style="margin-right: 0.5rem;"></i>
        <span th:text="${winningParty.party}"></span>
      </p>
      
      <p style="font-size: 1.1rem; color: #555; max-width: 800px; margin: 0 auto 1rem;">
        We are pleased to announce the winner of the election. Thank you to all candidates and voters for participating in this democratic process.
      </p>
    </div>

    <!-- Election Statistics -->
    <div th:if="${totalVotes != null}" class="stats-card">
      <h2 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #f0f0f0; padding-bottom: 0.5rem;">
        <i class="fas fa-chart-bar" style="margin-right: 0.5rem; color: #3498db;"></i>
        Election Statistics
      </h2>
      
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-label">Total Votes Cast</div>
          <div class="stat-value" th:text="${totalVotes}">0</div>
          <div class="stat-label">across all candidates</div>
        </div>
        
        <div class="stat-item">
          <div class="stat-label">Number of Candidates</div>
          <div class="stat-value" th:text="${allCandidates != null ? allCandidates.size() : 0}">0</div>
          <div class="stat-label">participated</div>
        </div>
        
        <div class="stat-item" th:if="${winningParty}">
          <div class="stat-label">Winning Margin</div>
          <div class="stat-value" th:text="${winningParty.voteCount}">0</div>
          <div class="stat-label">votes</div>
        </div>
      </div>
    </div>

    <!-- Results Chart -->
    <div th:if="${allCandidates != null && !allCandidates.isEmpty()}" class="chart-container">
      <h2 style="margin-top: 0; color: #2c3e50; margin-bottom: 1.5rem;">
        <i class="fas fa-chart-pie" style="margin-right: 0.5rem; color: #e74c3c;"></i>
        Vote Distribution
      </h2>
      <canvas id="resultsChart" height="100"></canvas>
    </div>

    <!-- Detailed Results -->
    <div th:if="${allCandidates != null && !allCandidates.isEmpty()}" style="margin-top: 2rem;">
      <h2 style="color: #2c3e50; border-bottom: 2px solid #f0f0f0; padding-bottom: 0.5rem; margin-bottom: 1.5rem;">
        <i class="fas fa-list-ol" style="margin-right: 0.5rem; color: #2ecc71;"></i>
        Detailed Results
      </h2>
      
      <div th:each="candidate : ${allCandidates}" class="candidate-card" 
           th:classappend="${winningParty != null && winningParty.id == candidate.id} ? 'winner-card' : ''"
           style="border-left: 5px solid ${winningParty != null && winningParty.id == candidate.id} ? '#ffd700' : '#f0f0f0';">
        
        <img th:src="${candidate.candidateImagePath}" class="candidate-image" alt="Candidate">
        
        <div class="candidate-info">
          <div class="candidate-header">
            <h3 class="candidate-name" th:text="${candidate.firstname} + ' ' + ${candidate.lastname}"></h3>
            <span th:if="${winningParty != null && winningParty.id == candidate.id}" 
                  style="background: #ffd700; color: #8b6914; padding: 0.2rem 0.8rem; border-radius: 20px; font-size: 0.8rem; margin-left: 1rem;">
              <i class="fas fa-trophy"></i> Winner
            </span>
          </div>
          
          <p class="candidate-party">
            <i class="fas fa-landmark" style="margin-right: 0.5rem;"></i>
            <span th:text="${candidate.party}"></span>
          </p>
          
          <div class="vote-count">
            <i class="fas fa-vote-yea" style="margin-right: 0.5rem; color: #3498db;"></i>
            <span th:text="${candidate.voteCount != null ? candidate.voteCount : 0} + ' votes'"></span>
            <span class="vote-percentage" th:if="${totalVotes > 0}" 
                  th:text="'%' + ${#numbers.formatDecimal((candidate.voteCount != null ? candidate.voteCount : 0) / totalVotes * 100, 1, 1) + ' of total'}">
            </span>
          </div>
          
          <div class="progress-container" th:if="${totalVotes > 0}">
            <div class="progress-bar" 
                 th:style="'width: ' + ${(candidate.voteCount != null ? candidate.voteCount : 0) / totalVotes * 100} + '%;'">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart.js Script -->
  <script th:if="${allCandidates != null && !allCandidates.isEmpty()}">
    document.addEventListener('DOMContentLoaded', function() {
      const ctx = document.getElementById('resultsChart').getContext('2d');
      const candidates = [[${#strings.listJoin(#strings.arrayJoin(#lists.sort(allCandidates.![firstname + ' ' + lastname]), '","'), '"', '"')}]];
      const votes = [[${#strings.listJoin(#strings.arrayJoin(#lists.sort(allCandidates.![voteCount != null ? voteCount : 0]), ','), '', '')}]];
      
      // Generate random colors for the chart
      const backgroundColors = [];
      const borderColors = [];
      
      for (let i = 0; i < candidates.length; i++) {
        const r = Math.floor(Math.random() * 200) + 55;
        const g = Math.floor(Math.random() * 200) + 55;
        const b = Math.floor(Math.random() * 200) + 55;
        backgroundColors.push(`rgba(${r}, ${g}, ${b}, 0.5)`);
        borderColors.push(`rgba(${r}, ${g}, ${b}, 1)`);
      }
      
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: candidates,
          datasets: [{
            label: 'Votes',
            data: votes,
            backgroundColor: backgroundColors,
            borderColor: borderColors,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Number of Votes'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Candidates'
              }
            }
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const total = votes.reduce((a, b) => a + b, 0);
                  const value = context.raw;
                  const percentage = Math.round((value / total) * 100);
                  return `${value} votes (${percentage}%)`;
                }
              }
            }
          }
        }
      });
    });
  </script>
</body>
</html>